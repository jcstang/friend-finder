<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://kit.fontawesome.com/d54a006847.js" crossorigin="anonymous"></script>
  <title>Friend Finder | Home</title>
</head>

<body>
  <div class="container">
    <header>
      {{{ body }}}
    </header>
    <footer>
      api | github
    </footer>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      console.log('jquery loaded.');
      const scoreArray = [];

      //$("#survey-form").on("submit" function() {
        //event.preventDefault();

        //let thing = $('#key-q1').val();
        //console.log(`here is thing: ${thing}`);

      //});

      $("#survey-form").on("submit", function() {
        event.preventDefault();

        // let thing = $('#key-q1').val();
        // console.log(`here is thing: ${thing}`);
        if(scoreArray.length === 0) {
          for(let i = 1; i <= 10; i++) {
            // get just the number like 1. out of string 1 (strongly disagree)
            let newScore = $(`#key-q${i}`).val().charAt(0);

            scoreArray.push( parseInt(newScore) );
          }

        }

        //console.log('here is scoreArray');
        //console.log(scoreArray);

        //let friendToPost = {
          //name: 'joe',
          //photo: 'https://media.licdn.com/mpr/mpr/shrinknp_200_200/AAEAAQAAAAAAAAq7AAAAJDAwYzI4NTQ4LWYwZWUtNGFkYS1hNTYwLTZjYzkwY2ViZDA3OA.jpg',
          //scores: scoreArray
        //};

        let friendToPost = {
          name: $("#friendName").val().trim(),
          photo: $("#friendImg").val().trim(),
          scores: scoreArray
        };

        console.log("here is friendToPost, before we ajax");
        console.log(friendToPost);



        // TODO: get ALL of the fields and package them into an object
        // TODO: save that object to file?

        // Send the POST request.
        $.ajax("/api/friends", {
          type: "POST",
          data: friendToPost
        }).then(
          function(req, res) {
            console.log(res);
            console.log('yay the post thing just happened!');
            
            location.reload();
          }
        );

        //$.ajax({'/api/friends',
          //type: "POST",
          //data: friendToPost,
          //success: function( data, status ) {
            //console.log(`status for the post... ${status}`);
          //},
          //error: function( req, status, err ) {
            ////console.log( 'something went wrong', status, err );
            //console.log(`something went wrong... ${status} ${err}`);
          //}
        //});


      });


    });

  </script>
</body>

</html>